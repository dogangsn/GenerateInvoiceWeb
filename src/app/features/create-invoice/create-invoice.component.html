<div class="flex h-screen overflow-hidden bg-slate-50">
    <!-- Left Side: Form -->
    <div class="w-1/2 h-full overflow-y-auto border-r border-slate-200 bg-white p-8">
        <div class="max-w-2xl mx-auto space-y-8">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-slate-900">Yeni Fatura Oluştur</h1>
                <app-button variant="ghost" icon="arrow_back" (click)="goBack()">Geri Dön</app-button>
            </div>

            <!-- Fatura Bilgileri -->
            <section class="space-y-4">
                <h2 class="text-lg font-bold text-slate-900 border-b border-slate-100 pb-2">Fatura Bilgileri</h2>
                <div class="grid grid-cols-2 gap-4">
                    <app-input label="Fatura Tipi" placeholder="Satış" [disabled]="true"></app-input>
                    <app-input label="Fatura Senaryosu" placeholder="Temel Fatura" [disabled]="true"></app-input>
                    <app-input label="Fatura Tarihi" type="date"
                        [formControl]="$any(invoiceForm.get('date'))"></app-input>
                    <app-input label="Fatura Saati" type="time"
                        [formControl]="$any(invoiceForm.get('time'))"></app-input>
                </div>
            </section>

            <!-- Müşteri Bilgileri -->
            <section class="space-y-4">
                <h2 class="text-lg font-bold text-slate-900 border-b border-slate-100 pb-2">Müşteri Bilgileri</h2>
                <app-input label="Müşteri Adı / Ünvanı" placeholder="Müşteri adını girin"
                    [formControl]="$any(invoiceForm.get('customerName'))"></app-input>
                <div class="grid grid-cols-2 gap-4">
                    <app-input label="Vergi Numarası" placeholder="Vergi numarasını girin"
                        [formControl]="$any(invoiceForm.get('taxId'))"></app-input>
                    <app-input label="Adres" placeholder="Müşteri adresini girin"
                        [formControl]="$any(invoiceForm.get('address'))"></app-input>
                </div>
            </section>

            <!-- Vergi Ayarları -->
            <section class="space-y-4">
                <h2 class="text-lg font-bold text-slate-900 border-b border-slate-100 pb-2">Vergi Ayarları (Türkiye)
                </h2>
                <div class="flex items-center gap-4 bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Vergi Adı</label>
                        <input type="text" value="KDV" disabled
                            class="w-full bg-white rounded border-slate-300 text-sm">
                    </div>
                    <div class="w-24">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Oran (%)</label>
                        <input type="number" value="20" disabled
                            class="w-full bg-white rounded border-slate-300 text-sm">
                    </div>
                    <div class="flex items-center pt-6">
                        <input type="checkbox" checked disabled class="h-5 w-5 rounded border-slate-300 text-primary">
                    </div>
                </div>
            </section>

            <!-- Fatura Kalemleri -->
            <section class="space-y-4">
                <h2 class="text-lg font-bold text-slate-900 border-b border-slate-100 pb-2">Fatura Kalemleri</h2>

                <div class="space-y-4">
                    <div *ngFor="let item of items.controls; let i = index" [formGroup]="$any(item)"
                        class="flex gap-3 items-start p-4 bg-slate-50 rounded-lg border border-slate-200 group">
                        <div class="flex-1">
                            <label class="block text-xs font-medium text-slate-500 mb-1">Açıklama</label>
                            <input type="text" formControlName="description"
                                class="w-full rounded border-slate-300 text-sm" placeholder="Ürün/Hizmet adı">
                        </div>
                        <div class="w-20">
                            <label class="block text-xs font-medium text-slate-500 mb-1">Miktar</label>
                            <input type="number" formControlName="quantity"
                                class="w-full rounded border-slate-300 text-sm">
                        </div>
                        <div class="w-24">
                            <label class="block text-xs font-medium text-slate-500 mb-1">Birim Fiyat</label>
                            <input type="number" formControlName="unitPrice"
                                class="w-full rounded border-slate-300 text-sm">
                        </div>
                        <div class="w-24 pt-6 text-right font-medium text-slate-900">
                            {{ (item.get('quantity')?.value * item.get('unitPrice')?.value) |
                            currency:'TRY':'symbol-narrow':'1.2-2' }}
                        </div>
                        <button (click)="removeItem(i)" class="mt-6 text-slate-400 hover:text-red-600">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </div>
                </div>

                <button (click)="addItem()"
                    class="flex items-center gap-2 text-primary font-bold hover:text-blue-700 text-sm">
                    <span class="material-symbols-outlined text-lg">add_circle</span>
                    Yeni Kalem Ekle
                </button>
            </section>

            <!-- Actions -->
            <div class="flex items-center justify-end gap-4 pt-8 border-t border-slate-200">
                <app-button variant="secondary">Taslak Olarak Kaydet</app-button>
                <app-button variant="primary" (click)="saveInvoice()">Faturayı Oluştur</app-button>
            </div>
        </div>
    </div>

    <!-- Right Side: Preview -->
    <div class="w-1/2 h-full bg-slate-100 p-8 overflow-y-auto flex justify-center items-start">
        <!-- A4 Paper -->
        <div
            class="w-full max-w-[210mm] aspect-[210/297] bg-white shadow-2xl p-[10mm] md:p-[20mm] text-slate-900 text-sm relative">
            <!-- Header -->
            <div class="flex justify-between items-start mb-12">
                <div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">Şirket Adınız</h2>
                    <p class="text-slate-500 text-xs">Vergi Dairesi: Zincirlikuyu</p>
                    <p class="text-slate-500 text-xs">Vergi No: 1234567890</p>
                    <p class="text-slate-500 text-xs">İstanbul, Türkiye</p>
                </div>
                <div class="text-right">
                    <h1 class="text-4xl font-black text-slate-900 tracking-widest mb-4">FATURA</h1>
                    <div class="text-xs space-y-1">
                        <p><span class="font-bold text-slate-700">Fatura No:</span> INV-00123</p>
                        <p><span class="font-bold text-slate-700">Tarih:</span> {{ invoiceForm.get('date')?.value |
                            date:'dd/MM/yyyy' }}</p>
                    </div>
                </div>
            </div>

            <!-- Client Info -->
            <div class="mb-12 border-b border-slate-200 pb-8">
                <h3 class="font-bold text-slate-900 mb-2">Sayın:</h3>
                <p class="text-lg font-medium">{{ invoiceForm.get('customerName')?.value || 'Müşteri Adı' }}</p>
                <p class="text-slate-500">{{ invoiceForm.get('address')?.value || 'Adres bilgisi girilmedi' }}</p>
                <p class="text-slate-500 mt-1" *ngIf="invoiceForm.get('taxId')?.value">VN: {{
                    invoiceForm.get('taxId')?.value }}</p>
            </div>

            <!-- Items Table -->
            <table class="w-full mb-8">
                <thead>
                    <tr class="border-b-2 border-slate-900 text-xs uppercase tracking-wider">
                        <th class="text-left py-3">Açıklama</th>
                        <th class="text-right py-3 w-20">Miktar</th>
                        <th class="text-right py-3 w-32">Birim Fiyat</th>
                        <th class="text-right py-3 w-32">Toplam</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200">
                    <tr *ngFor="let item of items.controls">
                        <td class="py-4">{{ item.get('description')?.value }}</td>
                        <td class="text-right py-4">{{ item.get('quantity')?.value }}</td>
                        <td class="text-right py-4">{{ item.get('unitPrice')?.value |
                            currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                        <td class="text-right py-4 font-medium">{{ (item.get('quantity')?.value *
                            item.get('unitPrice')?.value) | currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                    </tr>
                </tbody>
            </table>

            <!-- Totals -->
            <div class="flex justify-end">
                <div class="w-64 space-y-3">
                    <div class="flex justify-between text-slate-600">
                        <span>Ara Toplam:</span>
                        <span>{{ calculateSubtotal() | currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                    </div>
                    <div class="flex justify-between text-slate-600">
                        <span>KDV (%20):</span>
                        <span>{{ calculateTax() | currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                    </div>
                    <div class="flex justify-between text-lg font-bold text-slate-900 border-t border-slate-900 pt-3">
                        <span>Genel Toplam:</span>
                        <span>{{ calculateTotal() | currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                    </div>
                </div>
            </div>

            <!-- Footer Note -->
            <div class="absolute bottom-[20mm] left-[20mm] right-[20mm] text-center text-xs text-slate-400">
                Ödemeleriniz için teşekkür ederiz. Sorularınız için bizimle iletişime geçebilirsiniz.
            </div>
        </div>
    </div>
</div>